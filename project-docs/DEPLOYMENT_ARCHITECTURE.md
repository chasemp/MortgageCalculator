# Deployment Architecture

## Overview

This project follows the `/src → /docs` deployment pattern for GitHub Pages, as established in the [peadoubleueh PWA template](https://github.com/chasemp/peadoubleueh).

## Build Process

```
Source Files (/src, /public)
    ↓
  Vite Build
    ↓
Build Output (/docs) - Auto-generated
    ↓
GitHub Pages Deployment
    ↓
Live Site (morty.523.life)
```

## Directory Structure

### `/src` - Source Code
- All React components, TypeScript files, and styles
- **ALWAYS edit these files**, never edit `/docs` directly

### `/public` - Static Assets
- `CNAME` - Custom domain configuration
- `manifest.json` - PWA manifest
- Icons and favicons
- Files copied as-is to build output

### `/docs` - Build Output (⚠️ NEVER EDIT MANUALLY)
- Auto-generated by `npm run build`
- Served by GitHub Pages
- Gitignored to prevent manual edits
- Rebuilt from source on every deployment

## Deployment Flow

### Development
```bash
npm run dev
# → Edit files in /src and /public
# → Hot reload on localhost:5173
```

### Build
```bash
npm run build
# → Vite processes /src files
# → Copies /public files
# → Outputs to /docs
# → CNAME is copied to /docs/CNAME
```

### Deploy
```bash
git add docs/
git commit -m "build: Update production build"
git push origin main
# → GitHub Actions runs
# → Deploys /docs to GitHub Pages
# → Live at morty.523.life
```

## GitHub Pages Configuration

### Repository Settings
1. Go to Settings → Pages
2. Source: Deploy from a branch
3. Branch: `main`
4. Folder: `/docs`

### Custom Domain
- CNAME file in `/public` contains `morty.523.life`
- Vite copies to `/docs/CNAME` during build
- GitHub Pages serves at custom domain

### DNS Configuration
Point your domain's DNS to GitHub Pages:
```
A Record:    185.199.108.153
A Record:    185.199.109.153
A Record:    185.199.110.153
A Record:    185.199.111.153
```
Or CNAME: `chasemp.github.io`

## GitHub Actions Workflow

Located at `.github/workflows/deploy.yml`:

1. **Trigger**: Push to `main` branch
2. **Build**: Runs `npm ci` and `npm run build`
3. **Upload**: Uploads `/docs` folder as artifact
4. **Deploy**: Deploys to GitHub Pages

## Key Differences from Traditional Setup

### ❌ Old Pattern (dist folder)
```
build: {
  outDir: 'dist'  // Not used by GitHub Pages directly
}
```

### ✅ New Pattern (docs folder)
```
build: {
  outDir: 'docs'  // GitHub Pages reads this directly
}
```

## Benefits

1. **Single Source of Truth**: GitHub Pages reads `/docs` directly
2. **No Build Artifacts in Git**: Source stays clean
3. **Clear Separation**: `/src` = edit, `/docs` = deploy
4. **Predictable Builds**: Always from source, never manual edits

## Troubleshooting

### Build not deploying?
- Check `/docs` is committed to git
- Verify GitHub Pages settings use `/docs` folder
- Check GitHub Actions logs

### CNAME not working?
- Ensure `public/CNAME` exists
- Verify it's copied to `docs/CNAME` after build
- Check DNS settings

### Assets not loading?
- Verify `base: '/'` in vite.config.ts (for custom domain)
- If using github.io subdirectory, use `base: '/repo-name/'`

## Related Documentation

- [PWA Development Workflow](./PWA_DEVELOPMENT_WORKFLOW.md)
- [PWA Quick Reference](./PWA_QUICK_REFERENCE.md)


